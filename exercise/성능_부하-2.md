# 부하란
다양한 관점에서 부하를 생각해본다.

## 두 종류의 부하
일반적으로 부하는 크게 두 가지로 분류해본다.
- CPU 부하
  - 예) 대규모 과학계산을 수행하는 프로그램
    - 디스크 입출력은 하지 않지만, 처리가 완료될 때까지 상당한 시간을 요한다.
    - 계산을 한다 = 이 프로그램의 속도는 CPU의 계산속도에 의존하고 있다.
    - CPU 바운드한 프로그램으로, CPU에 부하를 주는 프로그램
- I/O 부하
  - 예) 디스크에 의존해서 대량의 데이터로부터 임의의 문서를 찾아내는 검색 프로그램
    - 디스크에 의존 = 디스크의 읽기속도에 의존한다.
    - I/O 바운드한 프로그램으로, I/O에 부하를 주는 종류의 프로그램이다.

일반적으로 AP서버는 DB로부터 얻은 데이터를 가공해서 클라이언트로 전달하는 처리를 수행한다.<br>
AP 서버는 CPU 바운드한 서버라고 할 수 있다.

DB서버는 데이터를 디스크로부터 검색하는 것이 주된 일로, 데이터가 대규모가 되면 될수록<br>
CPU에서의 계산시간보다도 I/O에 대한 영향이 커지는 I/O 바운드한 서버다.

## 멀티 태스킹 OS와 부하
멀티태스킹 OS는 그 이름처럼 동시에 서로 다른 여러 태스크를 처리할 수 있다.<br>
여러 태스크를 실행한다고 해도 실제로는 리소스를 여러 태스크에서 공유할 필요가 있다.<br>
그래서 짧은 시간간격으로 여러 태스크를 전환해가면서 처리를 함으로써 멀티태스킹을 실현하고 있다.

실행할 태스크가 적은 상황에서 OS는 태스크에 대기를 발생하지 않고 전환을 할 수 있다.<br>
히지만 태스크가 늘어나면 특정 태스크가 CPU로 계산을 수행하고 있는 동안,<br>
다음으로 계산을 수행하고자 하는 다른 태스크들은 CPU에 시간이 날 때까지 대기하게된다.<br>
즉, `처리를 실행하려고 해도 대기한다` 라는 대기상태는 프로그램의 실행지연으로 나타난다.

Load Average는 단위시간당 대기된 태스크의 수, <br>
즉 평균적으로 어느정도의 태스크가 대기상태로 있었는지 보고하는 수치이다.<br>
(수치가 높다 = 지연되는 태스크가 많다 = 부하가 높다)
```
              1분   5분   15분
load average: 0.00, 0.01, 0.05
```

Load Average는 어디까지나 대기 태스크 수만 나타내는 수치이므로 부하가 높은 곳이 CPU인지 I/O인지를 판단할 수 없다.<br>
최종적으로 서버 리소스중 어디가 병목이 되고 있는지를 판단하려면 조금 더 자세히 조사할 필요가 있다.
- 어떤 값을 보면 OS의 병목을 판단할 수 있을까. 각각의 값은 OS가 무엇을 출력한 값일까
- Load Average가 나타내는 대기 태스크란 실제로 무엇을 기다리고 있는 태스크를 말할까
- 병목임을 알았을 때 어떤 프로세스가 부하의 원인이 되고 있는 것일까?

## 부하 정체 알기
결국 부하라는 것은 여러 태스크에 의한 서버 리소스 쟁탈의 결과로 생기는 대기 시간을 한마디로 나타낸 말인 것이다.<br>
그 정체를 알기 위해서는 `태스크가 대기되는 것은 어떤 경우인가`라는 OS의 거동, 즉 커널 동작을 이해할 필요가 있다.

태스크의 대기를 제어하는 것은, 리눅스 커널 내에서도 `프로세스 스케줄러`라는 프로그램이다.

프로세스 스케줄러는 멀티 태스킹 제어에 있어서 실행할 태스크의 우선순위를 결정해<br>
태스크를 대기시키거나 재개하는 등 커널의 중추적인 역할을 담당한다.
